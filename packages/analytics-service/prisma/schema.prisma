generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Read-only models for Analytics Service

model Property {
  id          BigInt   @id @default(autoincrement())
  name        String
  address     String?
  total_rooms Int
  admin_id    BigInt
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  rooms       Room[]
  expenses    Expense[]
  enrollments Enrollment[]

  @@map("properties")
}

model Room {
  id          BigInt   @id @default(autoincrement())
  property_id BigInt
  room_number String
  capacity    Int
  price       Decimal  @db.Decimal(10, 2)
  status      String   // 'occupied', 'vacant', 'maintenance'
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  property    Property @relation(fields: [property_id], references: [id])
  enrollments Enrollment[]

  @@map("rooms")
}

model Enrollment {
  id           BigInt   @id @default(autoincrement())
  user_id      BigInt
  property_id  BigInt
  room_id      BigInt
  start_date   DateTime
  end_date     DateTime?
  status       String   // 'active', 'ended'
  rent_amount  Decimal  @db.Decimal(10, 2)
  security_dep Decimal  @db.Decimal(10, 2)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  property     Property      @relation(fields: [property_id], references: [id])
  room         Room          @relation(fields: [room_id], references: [id])
  transactions Transaction[]

  @@map("enrollments")
}

model Transaction {
  id            BigInt    @id @default(autoincrement())
  enrollment_id BigInt?
  user_id       BigInt
  amount        Decimal   @db.Decimal(10, 2)
  type          String    // 'rent', 'security', 'due'
  status        String    // 'paid', 'pending', 'failed'
  payment_date  DateTime?
  due_date      DateTime?
  description   String?
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  enrollment    Enrollment? @relation(fields: [enrollment_id], references: [id])

  @@map("transactions")
}

enum PaymentMode {
  cash
  online
  upi
  bank_transfer
}

model Expense {
  expense_id    BigInt      @id @default(autoincrement())
  property_id   BigInt
  admin_id      BigInt
  category_id   BigInt
  amount        Decimal     @db.Decimal(12, 2)
  description   String?
  invoice_url   String?
  paid_to       String?
  paid_mode     PaymentMode
  expense_date  DateTime    @default(now())
  month_year    String      @db.VarChar
  created_at    DateTime    @default(now())
  updated_at    DateTime    @updatedAt

  property      Property    @relation(fields: [property_id], references: [id])

  @@map("expenses")
}
