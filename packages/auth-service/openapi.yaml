openapi: 3.0.3
info:
  title: Auth Service API
  version: 1.0.0
  description: Authentication and identity endpoints for MyStay.
servers:
  - url: http://localhost:3001
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /api/auth/register/customer:
    post:
      summary: Register a new customer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCustomerRequest'
      responses:
        '201':
          description: Registration success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '409':
          $ref: '#/components/responses/Conflict'
        '400':
          $ref: '#/components/responses/ValidationError'
  /api/auth/register/admin:
    post:
      summary: Register a new admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterAdminRequest'
      responses:
        '201':
          description: Registration success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '409':
          $ref: '#/components/responses/Conflict'
        '400':
          $ref: '#/components/responses/ValidationError'
  /api/auth/login:
    post:
      summary: Login using PIN or biometric token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthSuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/auth/forgot-pin/request:
    post:
      summary: Request OTP for PIN reset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPinRequest'
      responses:
        '200':
          description: OTP request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ForgotPinResponse'
  /api/auth/forgot-pin/verify:
    post:
      summary: Verify OTP and set new PIN
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPinVerifyRequest'
      responses:
        '200':
          description: PIN updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenericSuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/auth/me:
    get:
      summary: Get current authenticated user profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Resource conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
        service:
          type: string
          example: auth-service
    RegisterCustomerRequest:
      type: object
      required: [firstName, phone, pin]
      properties:
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        pin:
          type: string
        aadhaarOtpToken:
          type: string
    RegisterAdminRequest:
      type: object
      required: [firstName, phone]
      properties:
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        email:
          type: string
        pin:
          type: string
        aadhaarOtpToken:
          type: string
    LoginRequest:
      type: object
      required: [phone]
      properties:
        phone:
          type: string
        pin:
          type: string
        biometricToken:
          type: string
    ForgotPinRequest:
      type: object
      required: [phone]
      properties:
        phone:
          type: string
    ForgotPinVerifyRequest:
      type: object
      required: [phone, otp, newPin]
      properties:
        phone:
          type: string
        otp:
          type: string
        newPin:
          type: string
    AuthSuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        token:
          type: string
        user:
          $ref: '#/components/schemas/UserSummary'
    ProfileResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        user:
          $ref: '#/components/schemas/User'
    GenericSuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
    ForgotPinResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
    UserSummary:
      type: object
      properties:
        uniqueId:
          type: string
        firstName:
          type: string
        phone:
          type: string
        userType:
          type: string
    User:
      allOf:
        - $ref: '#/components/schemas/UserSummary'
        - type: object
          properties:
            lastName:
              type: string
            email:
              type: string
            aadhaarStatus:
              type: string
            addressLine1:
              type: string
            addressLine2:
              type: string
            city:
              type: string
            state:
              type: string
            pincode:
              type: string
            emergencyName:
              type: string
            emergencyPhone:
              type: string
            profession:
              type: string
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

